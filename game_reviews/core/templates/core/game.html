{% extends "core/base.html" %}

{% block title %}{{ game.title }}{% endblock %}

{% block content %}
<h1>{{ game.title }}</h1>

<div class="game-details">
    <img src="{{ game.image_url }}" alt="{{ game.title }}" class="game-image">

    <div class="game-info">
        <p><strong>Description:</strong> {{ game.description }}</p>
        <p><strong>Release Date:</strong> {{ game.release_date }}</p>
        <p><strong>Developer:</strong> {{ game.developer }}</p>
        <p><strong>Genre:</strong> {{ game.genre }}</p>
        <p><strong>Average Rating:</strong> {{ game.average_rating }} / 5</p>
    </div>
</div>

<h2>SteamDB Information</h2>
{% if steam_info %}
    <ul>
        <li><strong>overall score:</strong> {{ steam_info.overall_score }}</li>
        <li><strong>positive reviews:</strong> {{ steam_info.positive_reviews }}</li>
        <li><strong>negative reviews:</strong> {{ steam_info.negative_reviews }}</li>
    </ul>
{% else %}
    <p>{{ error_message }}</p>
{% endif %}

<h2>Reviews</h2>
{% if reviews %}
    <ul class="review-list">
        {% for review in reviews %}
            <li>
                <p><strong>{{ review.user.username }}</strong> rated this game {{ review.rating }} / 5</p>
                <p>{{ review.comment }}</p>
            </li>
        {% endfor %}
    </ul>
{% else %}
    <p>No reviews yet. Be the first to review this game!</p>
{% endif %}

<div class="game-actions">
    {% if user.is_authenticated %}
        {% if user.role == 'moderator' %}
            <a href="{% url 'edit_game' game.id %}" class="btn btn-primary">Edit Game</a>
        {% endif %}
        {% if user.role == 'admin' %}
            <a href="{% url 'delete_game' game.id %}" class="btn btn-danger">Delete Game</a>
        {% endif %}
    {% endif %}
</div>
    
    

<h3>Comments</h3>
{% if game.comments.exists %}
    <ul>
        {% for comment in game.comments.all %}
            <li>
                <p><strong>{{ comment.user.username }}</strong>:</p>
                <p>{{ comment.comment }}</p>
                <p><small>Posted on {{ comment.created_at }}</small></p>
                
                <!-- Display delete button only for moderators -->
                {% if user.is_authenticated and user.role == 'moderator' %}
                    <form action="{% url 'delete_comment' comment.id %}" method="post" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                    </form>
                {% endif %}
            </li>
        {% endfor %}
    </ul>
{% else %}
    <p>No comments yet. Be the first to comment on this game!</p>
{% endif %}


<!-- Add comment form -->
{% if user.is_authenticated %}
    <h3>Add a Comment</h3>
    <form method="post">
        {% csrf_token %}
        {{ comment_form.as_p }}
        <div class="emoji-picker">
        <span class="emoji">ğŸ˜€</span>
        <span class="emoji">ğŸ˜‚</span>
        <span class="emoji">ğŸ˜</span>
        <span class="emoji">ğŸ˜¢</span>
        <span class="emoji">ğŸ˜¡</span>
        <span class="emoji">ğŸ‘</span>
        <span class="emoji">â¤ï¸</span>
        <span class="emoji">ğŸ¤¡</span>
        <span class="emoji">ğŸ‘º</span>
        <span class="emoji">ğŸ’©</span>
        <span class="emoji">ğŸ™ˆ</span>
        <span class="emoji">ğŸ™‰</span>
        <!-- Add more emojis as needed -->
    </div>
        <button type="submit" class="btn btn-primary">Submit Comment</button>
    </form>
{% else %}
    <p>You need to <a href="{% url 'login' %}">log in</a> to comment on this game.</p>
{% endif %}  
    <script>
document.addEventListener("DOMContentLoaded", function() {
    // Get all emoji elements and the comment input field
    const emojis = document.querySelectorAll(".emoji");
    const commentField = document.querySelector("#id_comment");  // Adjust selector if needed

    emojis.forEach(emoji => {
        emoji.addEventListener("click", function() {
            // Append the emoji to the comment field
            commentField.value += emoji.textContent;
            commentField.focus();  // Bring focus back to the input field
        });
    });
});
</script>

{% endblock %}
